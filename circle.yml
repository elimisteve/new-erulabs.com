machine:
  python:
    version: 2.7

dependencies:
  pre:
    - pip install ansible
    - wget https://releases.hashicorp.com/terraform/0.6.16/terraform_0.6.16_linux_amd64.zip
    - unzip terraform_0.6.16_linux_amd64.zip
  override:
    - chmod +x bin/*
    - ./bin/clean.sh
    - ./bin/build.sh

test:
  override:
    - ./bin/test.sh

deployment:
  master:
    branch: [test, master]
    commands:
      - ./bin/inf.sh $CIRCLE_BRANCH
      - ./bin/playbook.sh $CIRCLE_BRANCH
      - ./bin/deploy.sh $CIRCLE_BRANCH
